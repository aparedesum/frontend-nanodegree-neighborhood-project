"use strict";var arrayLocation=[{name:"National Stadium",address:"Jose Diaz s/n,Lima 15046",phone:"4316190",url:"",location:{lat:-12.067297,lng:-77.033582}},{name:"Kenedy Park",address:"Diagonal, Lima, Peru",phone:"3133773",url:"",location:{lat:-12.120615,lng:-77.029627}},{name:"Starbucks",address:"Av. José Pardo 297, Miraflores",phone:"941 901 940",url:"",location:{lat:-12.119275,lng:-77.031756}},{name:"Supermercado Vivanda",address:"Av. José Pardo 715,Miraflores Lima 18",phone:"6203000",url:"",location:{lat:-12.119329,lng:-77.036093}},{name:"Cineplanet",address:"Av. Sta. Cruz 814,San Isidro 15073",phone:"6249500",url:"",location:{lat:-12.110299,lng:-77.037494}}],Location=function(o){var n=this;n.name=ko.observable(o.name),n.address=ko.observable(o.address),n.url=ko.observable(o.url),n.phone=ko.observable(o.phone),n.location=ko.observable(o.location),n.content=ko.computed(function(){return"<h3>"+n.name()+"</h3></a><p>"+n.address()+"</p><p>"+n.url()+"</p>"}),n.marker=ko.observable(new google.maps.Marker({position:new google.maps.LatLng(n.location().lat,n.location().lng),animation:google.maps.Animation.DROP,name:n.name(),address:n.address()}))},Recomendation=function(o){var n=this;n.name=ko.observable(o.name),n.address=ko.observable(""),n.url=ko.observable(o.hasOwnProperty("url")?o.url:""),null!==o.location&&o.location.hasOwnProperty("formattedAddress")&&o.location.formattedAddress.length>0&&(n.address=ko.observable(o.location.formattedAddress[0]+" - "+o.location.formattedAddress[1])),n.lat=ko.observable(o.location.lat),n.lng=ko.observable(o.location.lng),n.category=ko.observable(o.categories[0].name),n.marker=new google.maps.Marker({position:new google.maps.LatLng(n.lat(),n.lng()),animation:google.maps.Animation.DROP,name:n.name(),address:n.address()})},ViewModel=function(){var o=this,n={lat:-12.046374,lng:-77.042793};o.locations=ko.observableArray([]),o.recomendationsResult=ko.observableArray([]),o.filter=ko.observable(""),o.infoWindow=ko.observable(new google.maps.InfoWindow({}));var e="https://api.foursquare.com/v2/venues/search",a={};a.oauth_token="2DPQ3O4ITKQJCRO2O5ASTMDLK5H0IKPOBOCAVL1ZLZAVYTAQ",a.v="20151125",a.limit="10";var t={zoom:12,center:n,rotateControl:!0,mapTypeControl:!0,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.HORIZONTAL_BAR,position:google.maps.ControlPosition.TOP_CENTER},zoomControl:!0,zoomControlOptions:{position:google.maps.ControlPosition.LEFT_CENTER},scaleControl:!0,streetViewControl:!0,streetViewControlOptions:{position:google.maps.ControlPosition.LEFT_TOP}};o.map=new google.maps.Map(document.getElementById("map"),t),o.getContent=function(o){return"<h3>"+o.name()+"</h3></a><p>"+o.address()+"</p><p>"+o.url()+"</p>"},o.addListenerToMarkers=function(n){var e=n.marker();e.addListener("click",function(){o.removeAnimations(),e.setAnimation(google.maps.Animation.BOUNCE),o.setInfoWindow(o.getContent(n),o.map,e),o.map.panTo(e.position),o.searchRecomendations(n)}),google.maps.event.addListener(o.infoWindow(),"closeclick",function(){e.setAnimation(null)})},o.setInfoWindow=function(n,e,a){o.infoWindow().setContent(n),o.infoWindow().open(e,a)},arrayLocation.forEach(function(n){var e=new Location(n);o.locations.push(e),o.addListenerToMarkers(e)}),o.removeRecomendationsMarkers=function(){ko.utils.arrayForEach(o.recomendationsResult(),function(o){o.marker.setMap(null)})},o.removeLocationMarkers=function(){ko.utils.arrayForEach(o.locations(),function(o){o.marker().setMap(null)})},o.removeAnimations=function(){o.locations().forEach(function(o){o.marker().setAnimation(null)}),o.recomendationsResult.length>0&&o.recomendationsResult().forEach(function(o){o.marker.setAnimation(null)})},o.filteredLocations=ko.computed(function(){var n=o.filter().toLowerCase();o.removeLocationMarkers(),o.removeAnimations(),o.setInfoWindow(null,null,null);var e=[];return e=n?ko.utils.arrayFilter(this.locations(),function(o){return-1!==o.name().toLowerCase().indexOf(n.toLowerCase())}):o.locations(),0===e.length?e.push({name:"No results..."}):e.forEach(function(n){n.marker().setMap(o.map)}),e},o),o.focusLocation=function(n){null!==n&&n.hasOwnProperty("marker")&&(o.removeAnimations(),o.removeRecomendationsMarkers(),o.setInfoWindow(o.getContent(n),o.map,n.marker()),o.map.panTo(n.marker().position),n.marker().setAnimation(google.maps.Animation.BOUNCE),o.searchRecomendations(n))},o.searchRecomendations=function(n){a.ll=n.location().lat+","+n.location().lng;$.ajax({method:"GET",dataType:"json",url:e,data:a}).done(function(n){if(o.removeRecomendationsMarkers(),o.recomendationsResult.removeAll(),null!==n.response){var e=n.response.venues;e.forEach(function(n){null!==n.name&&""!==n.name&&o.recomendationsResult.push(new Recomendation(n))})}}).fail(function(o,n){alert("Problems loading foursquare recommendations, pleasy try later")})},o.focusRecomendation=function(n){if(null!==n&&n.hasOwnProperty("marker")){var e=n.marker;e.setMap(o.map),o.setOptionsRecomendation(n,e),e.addListener("click",function(){o.setOptionsRecomendation(n,e)}),google.maps.event.addListener(o.infoWindow(),"closeclick",function(){e.setAnimation(null)})}},o.setOptionsRecomendation=function(n,e){o.removeAnimations(),e.setAnimation(google.maps.Animation.BOUNCE),o.setInfoWindow(o.getContent(n),o.map,e),o.map.panTo(e.position)}};ko.applyBindings(new ViewModel);