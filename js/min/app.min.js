"use strict";function initMap(){var o={zoom:12,center:lima,rotateControl:!0,mapTypeControl:!0,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.HORIZONTAL_BAR,position:google.maps.ControlPosition.TOP_CENTER},zoomControl:!0,zoomControlOptions:{position:google.maps.ControlPosition.LEFT_CENTER},scaleControl:!0,streetViewControl:!0,streetViewControlOptions:{position:google.maps.ControlPosition.LEFT_TOP}};map=new google.maps.Map(document.getElementById("map"),o),panorama=new google.maps.StreetViewPanorama(document.getElementById("pano"),{position:lima,pov:{heading:34,pitch:10}}),bounds=new google.maps.LatLngBounds,ko.applyBindings(new ViewModel)}function errorMap(){alert("Problems loading the map, please try later")}var arrayLocation=[{name:"National Stadium",location:{lat:-12.067297,lng:-77.033582}},{name:"Kenedy Park",location:{lat:-12.120615,lng:-77.029627}},{name:"Starbucks",location:{lat:-12.119275,lng:-77.031756}},{name:"Supermercado Vivanda",location:{lat:-12.119329,lng:-77.036093}},{name:"Cineplanet",location:{lat:-12.110299,lng:-77.037494}}],lima={lat:-12.046374,lng:-77.042793},Location=function(o){var n=this;n.name=ko.observable(o.name),n.address=ko.observable(""),n.url=ko.observable(""),n.hereNow=ko.observable(""),n.location=ko.observable(o.location),n.marker=ko.observable(new google.maps.Marker({position:new google.maps.LatLng(n.location().lat,n.location().lng),animation:google.maps.Animation.DROP,map:map}))},Recomendation=function(o){var n=this;n.name=ko.observable(o.name),n.address=ko.observable(""),o.hasOwnProperty("location")&&o.location.hasOwnProperty("address")&&n.address(o.location.address),n.url=ko.observable(o.url),n.lat=ko.observable(o.location.lat),n.lng=ko.observable(o.location.lng),n.hereNow=ko.observable(o.hereNow.summary),n.marker=new google.maps.Marker({position:new google.maps.LatLng(n.lat(),n.lng()),animation:google.maps.Animation.DROP,map:map})},ViewModel=function(){var o=this;o.map=map,o.locations=ko.observableArray([]),o.recomendationsResult=ko.observableArray([]),o.filter=ko.observable(""),o.infoWindow=ko.observable(new google.maps.InfoWindow({}));var n="https://api.foursquare.com/v2/venues/search",e={};e.oauth_token="2DPQ3O4ITKQJCRO2O5ASTMDLK5H0IKPOBOCAVL1ZLZAVYTAQ",e.v="20151125",e.limit="10",o.getContent=function(o){var n="";return o.url()&&(n="<a href='"+o.url()+"'>"+o.url()+"</a>"),"<h3>"+o.name()+"</h3></a><p>"+o.address()+"</p>"+n+"<p>"+o.hereNow()+"</p>"},o.addListenerToMarkers=function(n){var e=n.marker();bounds.extend(new google.maps.LatLng(n.location().lat,n.location().lng)),e.addListener("click",function(){o.removeAnimations(),e.setAnimation(google.maps.Animation.BOUNCE),o.setPanorama(n.location()),o.searchRecomendations(n)}),google.maps.event.addListener(o.infoWindow(),"closeclick",function(){e.setAnimation(null)})},o.setInfoWindow=function(n,e,a){o.infoWindow().setContent(n),o.infoWindow().open(e,a)},arrayLocation.forEach(function(n){var e=new Location(n);o.locations.push(e),o.addListenerToMarkers(e)}),o.map.fitBounds(bounds),o.removeRecomendationsMarkers=function(){o.recomendationsResult().forEach(function(o){o.marker.setVisible(!1)})},o.removeAnimations=function(){o.locations().forEach(function(o){o.marker().setAnimation(null)})},o.filteredLocations=ko.computed(function(){o.removeAnimations(),o.infoWindow().close();var n=ko.utils.arrayFilter(this.locations(),function(n){var e;return(e=n.name().toLowerCase().indexOf(o.filter().toLowerCase())>=0)?(n.marker().setVisible(!0),e):void n.marker().setVisible(!1)});return 0===n.length&&n.push({name:"No results..."}),n},o),o.focusLocation=function(n){null!==n&&n.hasOwnProperty("marker")&&(o.removeAnimations(),o.removeRecomendationsMarkers(),o.searchRecomendations(n),o.setPanorama(n.location()))},o.searchRecomendations=function(a){e.ll=a.location().lat+","+a.location().lng,$.ajax({method:"GET",dataType:"json",url:n,data:e}).done(function(n){o.removeRecomendationsMarkers(),o.recomendationsResult.removeAll();var e=n.response;if(null!==e){var t=e.venues,i=t[0];a.address(i.location.address),a.url(i.url),a.hereNow(i.hereNow.summary),a.marker().setAnimation(google.maps.Animation.BOUNCE),o.map.panTo(a.marker().position),o.setInfoWindow(o.getContent(a),o.map,a.marker()),t.forEach(function(n){if(n!==i&&null!==n.name&&""!==n.name){var e=new Recomendation(n);o.recomendationsResult.push(e),e.marker.addListener("click",function(){o.setOptionsRecomendation(e,e.marker)}),google.maps.event.addListener(o.infoWindow(),"closeclick",function(){e.marker.setAnimation(null)})}})}}).fail(function(o,n){alert("Problems loading foursquare recommendations, pleasy try later")})},o.focusRecomendation=function(n){null!==n&&n.hasOwnProperty("marker")&&o.setOptionsRecomendation(n,n.marker)},o.setOptionsRecomendation=function(n,e){o.removeAnimations(),o.setPanorama(e.position),e.setAnimation(google.maps.Animation.BOUNCE),o.setInfoWindow(o.getContent(n),o.map,e),o.map.panTo(e.position)},o.setPanorama=function(o){panorama=new google.maps.StreetViewPanorama(document.getElementById("pano"),{position:o,pov:{heading:34,pitch:10}})}},map,panorama,bounds;