"use strict";var arrayLocation=[{name:"National Stadium",location:{lat:-12.067297,lng:-77.033582}},{name:"Kenedy Park",location:{lat:-12.120615,lng:-77.029627}},{name:"Starbucks",location:{lat:-12.119275,lng:-77.031756}},{name:"Supermercado Vivanda",location:{lat:-12.119329,lng:-77.036093}},{name:"Cineplanet",location:{lat:-12.110299,lng:-77.037494}}],lima={lat:-12.046374,lng:-77.042793},mapOptions={zoom:12,center:lima,rotateControl:!0,mapTypeControl:!0,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.HORIZONTAL_BAR,position:google.maps.ControlPosition.TOP_CENTER},zoomControl:!0,zoomControlOptions:{position:google.maps.ControlPosition.LEFT_CENTER},scaleControl:!0,streetViewControl:!0,streetViewControlOptions:{position:google.maps.ControlPosition.LEFT_TOP}},map=new google.maps.Map(document.getElementById("map"),mapOptions),panorama=new google.maps.StreetViewPanorama(document.getElementById("pano"),{position:lima,pov:{heading:34,pitch:10}}),bounds=new google.maps.LatLngBounds,Location=function(o){var e=this;e.name=ko.observable(o.name),e.address=ko.observable(""),e.url=ko.observable(""),e.hereNow=ko.observable(""),e.location=ko.observable(o.location),e.marker=ko.observable(new google.maps.Marker({position:new google.maps.LatLng(e.location().lat,e.location().lng),animation:google.maps.Animation.DROP,map:map}))},Recomendation=function(o){var e=this;e.name=ko.observable(o.name),e.address=ko.observable(""),o.hasOwnProperty("location")&&o.location.hasOwnProperty("address")&&e.address(o.location.address),e.url=ko.observable(o.url),e.lat=ko.observable(o.location.lat),e.lng=ko.observable(o.location.lng),e.hereNow=ko.observable(o.hereNow.summary),e.marker=new google.maps.Marker({position:new google.maps.LatLng(e.lat(),e.lng()),animation:google.maps.Animation.DROP,map:map})},ViewModel=function(){var o=this;o.map=map,o.locations=ko.observableArray([]),o.recomendationsResult=ko.observableArray([]),o.filter=ko.observable(""),o.infoWindow=ko.observable(new google.maps.InfoWindow({}));var e="https://api.foursquare.com/v2/venues/search",n={};n.oauth_token="2DPQ3O4ITKQJCRO2O5ASTMDLK5H0IKPOBOCAVL1ZLZAVYTAQ",n.v="20151125",n.limit="10",o.getContent=function(o){var e="";return o.url()&&(e="<a href='"+o.url()+"'>"+o.url()+"</a>"),"<h3>"+o.name()+"</h3></a><p>"+o.address()+"</p>"+e+"<p>"+o.hereNow()+"</p>"},o.addListenerToMarkers=function(e){var n=e.marker();bounds.extend(new google.maps.LatLng(e.location().lat,e.location().lng)),n.addListener("click",function(){o.removeAnimations(),n.setAnimation(google.maps.Animation.BOUNCE),o.setPanorama(e.location()),o.searchRecomendations(e)}),google.maps.event.addListener(o.infoWindow(),"closeclick",function(){n.setAnimation(null)})},o.setInfoWindow=function(e,n,a){o.infoWindow().setContent(e),o.infoWindow().open(n,a)},arrayLocation.forEach(function(e){var n=new Location(e);o.locations.push(n),o.addListenerToMarkers(n)}),o.map.fitBounds(bounds),o.removeRecomendationsMarkers=function(){o.recomendationsResult().forEach(function(o){o.marker.setVisible(!1)})},o.removeAnimations=function(){o.locations().forEach(function(o){o.marker().setAnimation(null)})},o.filteredLocations=ko.computed(function(){o.filter().toLowerCase();o.removeAnimations(),o.infoWindow().close();var e=ko.utils.arrayFilter(this.locations(),function(e){var n;return(n=e.name().toLowerCase().indexOf(o.filter().toLowerCase())>=0)?(e.marker().setVisible(!0),n):void e.marker().setVisible(!1)});return 0===e.length&&e.push({name:"No results..."}),e},o),o.focusLocation=function(e){null!==e&&e.hasOwnProperty("marker")&&(o.removeAnimations(),o.removeRecomendationsMarkers(),o.searchRecomendations(e),o.setPanorama(e.location()))},o.searchRecomendations=function(a){n.ll=a.location().lat+","+a.location().lng,$.ajax({method:"GET",dataType:"json",url:e,data:n}).done(function(e){o.removeRecomendationsMarkers(),o.recomendationsResult.removeAll();var n=e.response;if(null!==n){var t=n.venues,i=t[0];a.address(i.location.address),a.url(i.url),a.hereNow(i.hereNow.summary),a.marker().setAnimation(google.maps.Animation.BOUNCE),o.map.panTo(a.marker().position),o.setInfoWindow(o.getContent(a),o.map,a.marker()),t.forEach(function(e){if(e!==i&&null!==e.name&&""!==e.name){var n=new Recomendation(e);o.recomendationsResult.push(n),n.marker.addListener("click",function(){o.setOptionsRecomendation(n,n.marker)}),google.maps.event.addListener(o.infoWindow(),"closeclick",function(){n.marker.setAnimation(null)})}})}}).fail(function(o,e){alert("Problems loading foursquare recommendations, pleasy try later")})},o.focusRecomendation=function(e){null!==e&&e.hasOwnProperty("marker")&&o.setOptionsRecomendation(e,e.marker)},o.setOptionsRecomendation=function(e,n){o.removeAnimations(),o.setPanorama(n.position),n.setAnimation(google.maps.Animation.BOUNCE),o.setInfoWindow(o.getContent(e),o.map,n),o.map.panTo(n.position)},o.setPanorama=function(o){panorama=new google.maps.StreetViewPanorama(document.getElementById("pano"),{position:o,pov:{heading:34,pitch:10}})}};ko.applyBindings(new ViewModel);